/* jQuery state plugin | 0.1.5 | Disparity <disparity-github@yandex.ru> */
(function(e,t,n){"use strict";var r={options:{eventNamespace:"state",dataPrefix:"state-",stateDataKey:"state",events:["change.{namespace}","change-{state_name}.{namespace}","{action}.{namespace}","{action}-{state_name}.{namespace}"]},storage:function(t,r,i){if(i===n){return e.data(t,this.options.dataPrefix+r)}e.data(t,this.options.dataPrefix+r,i);return n},change:function(e,t,n){e.toggleClass(t,n)},is:function(e,t){return e.hasClass(t)},parser:function(t,r){var i={},s=[];if(r===null){r=n}if(typeof t==="string"){s=e.grep(t.split(/\s+/),function(t){return e.trim(t)!==""})}if(e.isArray(t)){s=t}if(e.isPlainObject(t)){e.extend(i,t)}e.each(s,function(e,t){i[t]=r});return i},notificator:function(t,r,i){if(i===n){i=this.is(t,r)}var s={action:i?"add":"remove",state_name:r,namespace:this.options.eventNamespace};e.each(this.options.events,function(n,o){o=o.replace(/\{(\w+)\}/g,function(e,t){return s[t]});var u=e.Event(o,{state:{name:r,value:i}});u.preventDefault();t.trigger(u)})},processor:function(e,t,r){if(typeof r!=="boolean"&&r!==n){throw{message:"Invalid argumment type"}}if(this.is(e,t)===r){return}this.change(e,t,r);this.notificator(e,t,r)}};var i={switchedState:function(t){var n=e.grep(r.storage(t.target,"one-groups")||[],function(n){return e.inArray(t.state.name,n)!==-1});e.each(n,function(n,r){s.removeState.call(e(t.target),e.grep(r,function(e){return e!==t.state.name}))})},onlyOne:function(e){s.removeState.call(e.data.$elements.not(this),e.state.name)}};var s={toggleState:function(t,n){t=r.parser(t,n);return this.each(function(n,i){e.each(t,function(t,n){r.processor(e(i),t,n)})})},addState:function(e){return s.toggleState.call(this,e,true)},removeState:function(e){return s.toggleState.call(this,e,false)},joinByState:function(t){var n=e.map(r.parser(t),function(e,t){return"add-"+t+"."+r.options.eventNamespace});return this.bind(n.join(" "),{$elements:this},i.onlyOne)},onlyOneState:function(t){t=e.map(r.parser(t),function(e,t){return t});return this.each(function(){var e=r.storage(this,"one-groups")||[];e.push(t);r.storage(this,"one-groups",e)})},loadStates:function(t){var n={};this.each(function(){var i=this,o=e(this),u=o.data(t||r.options.stateDataKey)||"";u=u.replace(/\{(.*?)\}/g,function(e,t){t.replace(/(\w+)(\.\w+)?/g,function(e,t,r){r=r||".default";n[r]||(n[r]={})&&(n[r][t]||(n[r][t]=[]));n[r][t].push(i)});return""});u=u.replace(/\[(.*?)\]/g,function(e,t){s.onlyOneState.call(o,t);return""});s.addState.call(o,u)});e.each(n,function(t){e.each(n[t],function(t,n){s.joinByState.call(e(n),t)})});return this},state:function(){if(arguments.length===2&&(typeof arguments[1]==="boolean"||arguments[1]===null||arguments[1]===n)||arguments.length===1&&e.isPlainObject(arguments[0])){return s.toggleState.apply(this,arguments)}if(arguments.length===1&&!e.isPlainObject(arguments[0])){return r.is(this,arguments[0])}if(arguments.length===2&&(typeof arguments[0]==="string"||e.isArray(arguments[0])||e.isPlainObject(arguments[0]))&&(typeof arguments[1]==="string"||e.isArray(arguments[1])||e.isPlainObject(arguments[1]))){s.onlyOneState.call(this,arguments[0]);s.joinByState.call(this,arguments[1]);return this}if(arguments.length===0){return s.loadStates.call(this)}throw{message:'Unexpected usage "state"'}},filter:function(t,i,s){var o=s[3].split(","),u=o[0],a=o[1]!==n&&e.trim(o[1])==="false"?false:true;return r.is(e(t),u)===a}};e.fn.state=s.state;e.extend(e.expr[":"],{state:s.filter});e(function(){e(t.body).bind("add."+r.options.eventNamespace,i.switchedState)})})(jQuery,window.document)